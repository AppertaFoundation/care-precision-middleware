[%- doc_date = json_path('/1/header/start_time') -%]
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<composition xmlns="http://schemas.openehr.org/v1" archetype_node_id="openEHR-EHR-COMPOSITION.encounter.v1">
    <name>
        <value>Deterioriation assessment</value>
    </name>
    <archetype_details>
        <archetype_id>
            <value>open_eREACT-Care</value>
        </archetype_id>
        <template_id>
            <value>[% json_path('/0/templateid') %]</value>
        </template_id>
        <rm_version>1.0.4</rm_version>
    </archetype_details>
    <!-- not messing with this; no idea how to transmogrify the JSON into it -->
    <language>
        <terminology_id>
            <value>ISO_639-1</value>
        </terminology_id>
        <code_string>en</code_string>
    </language>
    <territory>
        <terminology_id>
            <value>ISO_3166-1</value>
        </terminology_id>
        <code_string>GB</code_string>
    </territory>
    <category>
        <value>event</value>
        <defining_code>
            <terminology_id>
                <value>openehr</value>
            </terminology_id>
            <code_string>433</code_string>
        </defining_code>
    </category>
    <composer xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="PARTY_IDENTIFIED">
        <name>[% json_path('/1/header/composer/name') %]</name>
    </composer>
    <context>
        <start_time>
            <value>[% doc_date %]</value>
        </start_time>
        <setting>
            <value>nursing home</value>
            <defining_code>
                <terminology_id>
                    <value>openehr</value>
                </terminology_id>
                <code_string>237</code_string>
            </defining_code>
        </setting>
        <health_care_facility>
            <external_ref>
                <id xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="GENERIC_ID">
                    <value>9091</value>
                    <scheme>HOSPITAL-NS</scheme>
                </id>
                <namespace>HOSPITAL-NS</namespace>
                <type>PARTY</type>
            </external_ref>
            <name>[% json_path('/1/header/healthcare_facility') %]</name>
        </health_care_facility>
    </context>
    <content xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="SECTION" archetype_node_id="openEHR-EHR-SECTION.adhoc.v1">
        <name>
            <value>Assessment</value>
        </name>
        <archetype_details>
            <archetype_id>
                <value>openEHR-EHR-SECTION.adhoc.v1</value>
            </archetype_id>
            <rm_version>1.0.4</rm_version>
        </archetype_details>
        <items xsi:type="SECTION" archetype_node_id="openEHR-EHR-SECTION.adhoc.v1">
            <name>
                <value>NEWS2</value>
            </name>
            <archetype_details>
                <archetype_id>
                    <value>openEHR-EHR-SECTION.adhoc.v1</value>
                </archetype_id>
                <rm_version>1.0.4</rm_version>
            </archetype_details>
            <items xsi:type="OBSERVATION" archetype_node_id="openEHR-EHR-OBSERVATION.body_temperature.v2">
                <name>
                    <value>Temperature</value>
                </name>
                <uid xsi:type="HIER_OBJECT_ID">
                    <value>[% generate_uuid() %]</value>
                </uid>
                <archetype_details>
                    <archetype_id>
                        <value>openEHR-EHR-OBSERVATION.body_temperature.v2</value>
                    </archetype_id>
                    <rm_version>1.0.4</rm_version>
                </archetype_details>
                <language>
                    <terminology_id>
                        <value>ISO_639-1</value>
                    </terminology_id>
                    <code_string>en</code_string>
                </language>
                <encoding>
                    <terminology_id>
                        <value>IANA_character-sets</value>
                    </terminology_id>
                    <code_string>UTF-8</code_string>
                </encoding>
                <subject xsi:type="PARTY_SELF"/>
                <data archetype_node_id="at0002">
                    <name>
                        <value>History</value>
                    </name>
                    <origin>
                        <value>[% doc_date %]</value>
                    </origin>
                    <events xsi:type="POINT_EVENT" archetype_node_id="at0003">
                        <name>
                            <value>Any event</value>
                        </name>
                        <time>
                            <value>[% doc_date %]</value>
                        </time>
                        <data xsi:type="ITEM_TREE" archetype_node_id="at0001">
                            <name>
                                <value>Tree</value>
                            </name>
                            <items xsi:type="ELEMENT" archetype_node_id="at0004">
                                <name>
                                    <value>Temperature</value>
                                </name>
                                <value xsi:type="DV_QUANTITY">
                                    <magnitude>[% json_path('/1/news2/temperature/magnitude') %]</magnitude>
                                    <!-- FIXME: JSON has C here -->
                                    <units>Cel</units>
                                    <!-- FIXME: not represented in JSON -->
                                    <precision>1</precision>
                                </value>
                            </items>
                        </data>
                    </events>
                </data>
            </items>
            <!-- FIXME not sure what part of the JSON goes in here -->
            <items xsi:type="OBSERVATION" archetype_node_id="openEHR-EHR-OBSERVATION.pulse_oximetry.v1">
                <name>
                    <value>Pulse oximetry</value>
                </name>
                <uid xsi:type="HIER_OBJECT_ID">
                    <value>[% generate_uuid( ) %] </value>
                </uid>
                <archetype_details>
                    <archetype_id>
                        <value>openEHR-EHR-OBSERVATION.pulse_oximetry.v1</value>
                    </archetype_id>
                    <rm_version>1.0.4</rm_version>
                </archetype_details>
                <language>
                    <terminology_id>
                        <value>ISO_639-1</value>
                    </terminology_id>
                    <code_string>en</code_string>
                </language>
                <encoding>
                    <terminology_id>
                        <value>IANA_character-sets</value>
                    </terminology_id>
                    <code_string>UTF-8</code_string>
                </encoding>
                <subject xsi:type="PARTY_SELF"/>
                <data archetype_node_id="at0001">
                    <name>
                        <value>Event Series</value>
                    </name>
                    <origin>
                        <value>2020-11-17T16:34:03.874Z</value>
                    </origin>
                    <events xsi:type="POINT_EVENT" archetype_node_id="at0002">
                        <name>
                            <value>Any event</value>
                        </name>
                        <time>
                            <value>[% doc_date %]</value>
                        </time>
                        <data xsi:type="ITEM_TREE" archetype_node_id="at0003">
                            <name>
                                <value>Tree</value>
                            </name>
                            <items xsi:type="ELEMENT" archetype_node_id="at0006">
                                <name>
                                    <value>SpO</value>
                                </name>
                                <value xsi:type="DV_PROPORTION">
                                    <numerator>[% json_path('/1/news2/spO2') %]</numerator>
                                    <denominator>100.0</denominator>
                                    <type>2</type>
                                </value>
                            </items>
                        </data>
                        <state xsi:type="ITEM_TREE" archetype_node_id="at0014">
                            <name>
                                <value>Tree</value>
                            </name>
                            <items xsi:type="CLUSTER" archetype_node_id="openEHR-EHR-CLUSTER.inspired_oxygen.v1">
                                <name>
                                    <value>Inspired oxygen</value>
                                </name>
                                <archetype_details>
                                    <archetype_id>
                                        <value>openEHR-EHR-CLUSTER.inspired_oxygen.v1</value>
                                    </archetype_id>
                                    <rm_version>1.0.4</rm_version>
                                </archetype_details>
                                <items xsi:type="ELEMENT" archetype_node_id="at0051">
                                    <name>
                                        <value>Flow rate</value>
                                    </name>
                                    <value xsi:type="DV_QUANTITY">
                                        <magnitude>[% json_path('/1/news2/inspired_oxygen/flow_rate/magnitude') %]</magnitude>
                                        <units>[% json_path('/1/news2/inspired_oxygen/flow_rate/unit') %]</units>
                                        <!-- FIXME: not represented in JSON -->
                                        <precision>2</precision>
                                    </value>
                                </items>
                                <items xsi:type="ELEMENT" archetype_node_id="at0054">
                                    <name>
                                        <value>Method of oxygen delivery</value>
                                    </name>
                                    <value xsi:type="DV_TEXT">
                                        <value>[% json_path('/1/news2/inspired_oxygen/method_of_oxygen_delivery') %]</value>
                                    </value>
                                </items>
                            </items>
                        </state>
                    </events>
                </data>
            </items>
            <items xsi:type="OBSERVATION" archetype_node_id="openEHR-EHR-OBSERVATION.pulse.v1">
                <name>
                    <value>Pulse</value>
                </name>
                <uid xsi:type="HIER_OBJECT_ID">
                    <value>[% generate_uuid() %]</value>
                </uid>
                <archetype_details>
                    <archetype_id>
                        <value>openEHR-EHR-OBSERVATION.pulse.v1</value>
                    </archetype_id>
                    <rm_version>1.0.4</rm_version>
                </archetype_details>
                <language>
                    <terminology_id>
                        <value>ISO_639-1</value>
                    </terminology_id>
                    <code_string>en</code_string>
                </language>
                <encoding>
                    <terminology_id>
                        <value>IANA_character-sets</value>
                    </terminology_id>
                    <code_string>UTF-8</code_string>
                </encoding>
                <subject xsi:type="PARTY_SELF"/>
                <data archetype_node_id="at0002">
                    <name>
                        <value>history</value>
                    </name>
                    <origin>
                        <value>2020-11-17T16:34:03.874Z</value>
                    </origin>
                    <events xsi:type="POINT_EVENT" archetype_node_id="at0003">
                        <name>
                            <value>Any event</value>
                        </name>
                        <time>
                            <value>[% doc_date %]</value>
                        </time>
                        <data xsi:type="ITEM_TREE" archetype_node_id="at0001">
                            <name>
                                <value>structure</value>
                            </name>
                            <!-- FIXME: pulse is just a single value in JSON -->
                            <items xsi:type="ELEMENT" archetype_node_id="at0004">
                                <name xsi:type="DV_CODED_TEXT">
                                    <value>Pulse Rate</value>
                                    <defining_code>
                                        <terminology_id>
                                            <value>local</value>
                                        </terminology_id>
                                        <code_string>at1026</code_string>
                                    </defining_code>
                                </name>
                                <value xsi:type="DV_QUANTITY">
                                    <magnitude>[% json_path('/1/news2/pulse') %]</magnitude>
                                    <units>/min</units>
                                    <precision>0</precision>
                                </value>
                            </items>
                        </data>
                    </events>
                </data>
            </items>
            <items xsi:type="OBSERVATION" archetype_node_id="openEHR-EHR-OBSERVATION.respiration.v1">
                <name>
                    <value>Respirations</value>
                </name>
                <uid xsi:type="HIER_OBJECT_ID">
                    <value>[% generate_uuid() %]</value>
                </uid>
                <archetype_details>
                    <archetype_id>
                        <value>openEHR-EHR-OBSERVATION.respiration.v1</value>
                    </archetype_id>
                    <rm_version>1.0.4</rm_version>
                </archetype_details>
                <language>
                    <terminology_id>
                        <value>ISO_639-1</value>
                    </terminology_id>
                    <code_string>en</code_string>
                </language>
                <encoding>
                    <terminology_id>
                        <value>IANA_character-sets</value>
                    </terminology_id>
                    <code_string>UTF-8</code_string>
                </encoding>
                <subject xsi:type="PARTY_SELF"/>
                <data archetype_node_id="at0001">
                    <name>
                        <value>history</value>
                    </name>
                    <origin>
                        <value>2020-11-17T16:34:03.874Z</value>
                    </origin>
                    <events xsi:type="POINT_EVENT" archetype_node_id="at0002">
                        <name>
                            <value>Any event</value>
                        </name>
                        <time>
                            <value>[% doc_date %]</value>
                        </time>
                        <data xsi:type="ITEM_TREE" archetype_node_id="at0003">
                            <name>
                                <value>List</value>
                            </name>
                            <items xsi:type="ELEMENT" archetype_node_id="at0004">
                                <name>
                                    <value>Rate</value>
                                </name>
                                <!-- FIXME: respirations is just a single value in JSON -->
                                <value xsi:type="DV_QUANTITY">
                                    <magnitude>[% json_path('/1/news2/respirations') %]</magnitude>
                                    <units>/min</units>
                                    <precision>0</precision>
                                </value>
                            </items>
                        </data>
                    </events>
                </data>
            </items>
            <items xsi:type="OBSERVATION" archetype_node_id="openEHR-EHR-OBSERVATION.acvpu.v0">
                <name>
                    <value>ACVPU scale</value>
                </name>
                <uid xsi:type="HIER_OBJECT_ID">
                    <value>[% generate_uuid() %]</value>
                </uid>
                <archetype_details>
                    <archetype_id>
                        <value>openEHR-EHR-OBSERVATION.acvpu.v0</value>
                    </archetype_id>
                    <rm_version>1.0.4</rm_version>
                </archetype_details>
                <language>
                    <terminology_id>
                        <value>ISO_639-1</value>
                    </terminology_id>
                    <code_string>en</code_string>
                </language>
                <encoding>
                    <terminology_id>
                        <value>IANA_character-sets</value>
                    </terminology_id>
                    <code_string>UTF-8</code_string>
                </encoding>
                <subject xsi:type="PARTY_SELF"/>
                <data archetype_node_id="at0001">
                    <name>
                        <value>Event Series</value>
                    </name>
                    <origin>
                        <value>2020-11-17T16:34:03.875Z</value>
                    </origin>
                    <events xsi:type="POINT_EVENT" archetype_node_id="at0002">
                        <name>
                            <value>Any point in time event</value>
                        </name>
                        <time>
                            <value>[% doc_date %]</value>
                        </time>
                        <data xsi:type="ITEM_TREE" archetype_node_id="at0003">
                            <name>
                                <value>Tree</value>
                            </name>
                            <items xsi:type="ELEMENT" archetype_node_id="at0004">
                                <name>
                                    <value>ACVPU</value>
                                </name>
                                <value xsi:type="DV_CODED_TEXT">
                                    <value>[% json_path('/1/news2/acvpu/value') %]</value>
                                    <defining_code>
                                        <terminology_id>
                                            <value>local</value>
                                        </terminology_id>
                                        <code_string>[% json_path('/1/news2/acvpu/code') %]</code_string>
                                    </defining_code>
                                </value>
                            </items>
                        </data>
                    </events>
                </data>
            </items>
            <items xsi:type="OBSERVATION" archetype_node_id="openEHR-EHR-OBSERVATION.blood_pressure.v2">
                <name>
                    <value>Blood pressure</value>
                </name>
                <uid xsi:type="HIER_OBJECT_ID">
                    <value>[% generate_uuid() %]</value>
                </uid>
                <archetype_details>
                    <archetype_id>
                        <value>openEHR-EHR-OBSERVATION.blood_pressure.v2</value>
                    </archetype_id>
                    <rm_version>1.0.4</rm_version>
                </archetype_details>
                <language>
                    <terminology_id>
                        <value>ISO_639-1</value>
                    </terminology_id>
                    <code_string>en</code_string>
                </language>
                <encoding>
                    <terminology_id>
                        <value>IANA_character-sets</value>
                    </terminology_id>
                    <code_string>UTF-8</code_string>
                </encoding>
                <subject xsi:type="PARTY_SELF"/>
                <data archetype_node_id="at0001">
                    <name>
                        <value>History</value>
                    </name>
                    <origin>
                        <value>2020-11-17T16:34:03.875Z</value>
                    </origin>
                    <events xsi:type="POINT_EVENT" archetype_node_id="at0006">
                        <name>
                            <value>Any event</value>
                        </name>
                        <time>
                            <value>[% doc_date %]</value>
                        </time>
                        <data xsi:type="ITEM_TREE" archetype_node_id="at0003">
                            <name>
                                <value>blood pressure</value>
                            </name>
                            <items xsi:type="ELEMENT" archetype_node_id="at0004">
                                <name>
                                    <value>Systolic</value>
                                </name>
                                <value xsi:type="DV_QUANTITY">
                                    <magnitude>[% json_path('/1/news2/systolic') %]</magnitude>
                                    <units>mm[Hg]</units>
                                    <precision>0</precision>
                                </value>
                            </items>
                            <!-- FIXME: diastolic is just a scalar value in the JSON -->
                            <items xsi:type="ELEMENT" archetype_node_id="at0005">
                                <name>
                                    <value>Diastolic</value>
                                </name>
                                <value xsi:type="DV_QUANTITY">
                                    <magnitude>[% json_path('/1/news2/diastolic') %]</magnitude>
                                    <units>mm[Hg]</units>
                                    <precision>0</precision>
                                </value>
                            </items>
                        </data>
                    </events>
                </data>
            </items>
            <items xsi:type="OBSERVATION" archetype_node_id="openEHR-EHR-OBSERVATION.news2.v1">
                <name>
                    <value>NEWS2 Score</value>
                </name>
                <archetype_details>
                    <archetype_id>
                        <value>openEHR-EHR-OBSERVATION.news2.v1</value>
                    </archetype_id>
                    <rm_version>1.0.4</rm_version>
                </archetype_details>
                <language>
                    <terminology_id>
                        <value>ISO_639-1</value>
                    </terminology_id>
                    <code_string>en</code_string>
                </language>
                <encoding>
                    <terminology_id>
                        <value>IANA_character-sets</value>
                    </terminology_id>
                    <code_string>UTF-8</code_string>
                </encoding>
                <subject xsi:type="PARTY_SELF"/>
                <data archetype_node_id="at0001">
                    <name>
                        <value>Event Series</value>
                    </name>
                    <origin>
                        <value>2020-09-14T20:30:35.08Z</value>
                    </origin>
                    <events xsi:type="POINT_EVENT" archetype_node_id="at0002">
                        <name>
                            <value>Any point in time event</value>
                        </name>
                        <time>
                            <value>2020-09-14T20:30:35.08Z</value>
                        </time>
                        <data xsi:type="ITEM_TREE" archetype_node_id="at0003">
                            <name>
                                <value>Tree</value>
                            </name>
                            <items xsi:type="ELEMENT" archetype_node_id="at0006">
                                <name>
                                    <value>Respiration rate</value>
                                </name>
                                <value xsi:type="DV_ORDINAL">
                                    <value>3</value>
                                    <symbol>
                                        <value>25</value>
                                        <defining_code>
                                            <terminology_id>
                                                <value>local</value>
                                            </terminology_id>
                                            <code_string>at0064</code_string>
                                        </defining_code>
                                    </symbol>
                                </value>
                            </items>
                            <items xsi:type="ELEMENT" archetype_node_id="at0029">
                                <name>
                                    <value>SpO Scale 1</value>
                                </name>
                                <value xsi:type="DV_ORDINAL">
                                    <value>0</value>
                                    <symbol>
                                        <value>96</value>
                                        <defining_code>
                                            <terminology_id>
                                                <value>local</value>
                                            </terminology_id>
                                            <code_string>at0030</code_string>
                                        </defining_code>
                                    </symbol>
                                </value>
                            </items>
                            <items xsi:type="ELEMENT" archetype_node_id="at0034">
                                <name>
                                    <value>Air or oxygen?</value>
                                </name>
                                <value xsi:type="DV_ORDINAL">
                                    <value>2</value>
                                    <symbol>
                                        <value>Oxygen</value>
                                        <defining_code>
                                            <terminology_id>
                                                <value>local</value>
                                            </terminology_id>
                                            <code_string>at0037</code_string>
                                        </defining_code>
                                    </symbol>
                                </value>
                            </items>
                            <items xsi:type="ELEMENT" archetype_node_id="at0004">
                                <name>
                                    <value>Systolic blood pressure</value>
                                </name>
                                <value xsi:type="DV_ORDINAL">
                                    <value>1</value>
                                    <symbol>
                                        <value>101-110</value>
                                        <defining_code>
                                            <terminology_id>
                                                <value>local</value>
                                            </terminology_id>
                                            <code_string>at0015</code_string>
                                        </defining_code>
                                    </symbol>
                                </value>
                            </items>
                            <items xsi:type="ELEMENT" archetype_node_id="at0005">
                                <name>
                                    <value>Pulse</value>
                                </name>
                                <value xsi:type="DV_ORDINAL">
                                    <value>2</value>
                                    <symbol>
                                        <value>111-130</value>
                                        <defining_code>
                                            <terminology_id>
                                                <value>local</value>
                                            </terminology_id>
                                            <code_string>at0011</code_string>
                                        </defining_code>
                                    </symbol>
                                </value>
                            </items>
                            <items xsi:type="ELEMENT" archetype_node_id="at0008">
                                <name>
                                    <value>Consciousness</value>
                                </name>
                                <value xsi:type="DV_ORDINAL">
                                    <value>3</value>
                                    <symbol>
                                        <value>C, V, P or U</value>
                                        <defining_code>
                                            <terminology_id>
                                                <value>local</value>
                                            </terminology_id>
                                            <code_string>at0025</code_string>
                                        </defining_code>
                                    </symbol>
                                </value>
                            </items>
                            <items xsi:type="ELEMENT" archetype_node_id="at0007">
                                <name>
                                    <value>Temperature</value>
                                </name>
                                <value xsi:type="DV_ORDINAL">
                                    <value>0</value>
                                    <symbol>
                                        <value>36.1-38.0</value>
                                        <defining_code>
                                            <terminology_id>
                                                <value>local</value>
                                            </terminology_id>
                                            <code_string>at0022</code_string>
                                        </defining_code>
                                    </symbol>
                                </value>
                            </items>
                            <items xsi:type="ELEMENT" archetype_node_id="at0028">
                                <name>
                                    <value>Total score</value>
                                </name>
                                <value xsi:type="DV_COUNT">
                                    <magnitude>8</magnitude>
                                </value>
                            </items>
                            <items xsi:type="ELEMENT" archetype_node_id="at0056">
                                <name>
                                    <value>Clinical risk category</value>
                                </name>
                                <value xsi:type="DV_CODED_TEXT">
                                    <value>Medium</value>
                                    <defining_code>
                                        <terminology_id>
                                            <value>local</value>
                                        </terminology_id>
                                        <code_string>at0059</code_string>
                                    </defining_code>
                                </value>
                            </items>
                        </data>
                    </events>
                </data>
            </items>
        </items>
    </content>
    <content xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="SECTION" archetype_node_id="openEHR-EHR-SECTION.adhoc.v1">
        <name>
            <value>Response</value>
        </name>
        <archetype_details>
            <archetype_id>
                <value>openEHR-EHR-SECTION.adhoc.v1</value>
            </archetype_id>
            <rm_version>1.0.4</rm_version>
        </archetype_details>
        <items xsi:type="EVALUATION" archetype_node_id="openEHR-EHR-EVALUATION.recommendation.v1">
            <name>
                <value>Recommendation</value>
            </name>
            <uid xsi:type="HIER_OBJECT_ID">
                <value>[% generate_uuid() %]</value>
            </uid>
            <archetype_details>
                <archetype_id>
                    <value>openEHR-EHR-EVALUATION.recommendation.v1</value>
                </archetype_id>
                <rm_version>1.0.4</rm_version>
            </archetype_details>
            <language>
                <terminology_id>
                    <value>ISO_639-1</value>
                </terminology_id>
                <code_string>en</code_string>
            </language>
            <encoding>
                <terminology_id>
                    <value>IANA_character-sets</value>
                </terminology_id>
                <code_string>UTF-8</code_string>
            </encoding>
            <subject xsi:type="PARTY_SELF"/>
            <data xsi:type="ITEM_TREE" archetype_node_id="at0001">
                <name>
                    <value>Tree</value>
                </name>
                <items xsi:type="ELEMENT" archetype_node_id="at0002">
                    <name>
                        <value>Recommendation</value>
                    </name>
                    <value xsi:type="DV_TEXT">
                        <value>Enhanced monitoring</value>
                    </value>
                </items>
            </data>
        </items>
    </content>
</composition>
